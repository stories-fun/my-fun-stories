<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Emotion Canvas: Reaction Animation Designer</title>

		<!-- Tailwind CSS -->
		<script src="https://cdn.tailwindcss.com"></script>

		<!-- Plotly.js -->
		<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

		<!-- GSAP for Animations -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

		<!-- Font Awesome -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

		<!-- Google Fonts -->
		<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Montserrat:wght@400;700&display=swap" rel="stylesheet" />

		<script>
			tailwind.config = {
				darkMode: "class",
				theme: {
					extend: {
						colors: {
							"emotion-primary": "#8B5CF6", // Vibrant Purple
							"emotion-secondary": "#EC4899", // Soft Pink
							"emotion-accent": "#22D3EE", // Cyan
							"emotion-dark": "#1E1B4B", // Deep Purple
                            "joy": "#FFD700",
                            "surprise": "#FF4500",
                            "calm": "#00CED1"
						},
						fontFamily: {
							heading: ["Poppins", "sans-serif"],
							body: ["Montserrat", "sans-serif"],
						},
					},
				},
			};
		</script>

		<style>
			body {
				font-family: "Montserrat", sans-serif;
				transition: all 0.3s ease;
				background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
			}
			body.dark {
				background: linear-gradient(135deg, #111827 0%, #1f2937 100%);
                color: #f3f4f6;
			}
			.animation-container {
				perspective: 1000px;
			}
			.bubble-btn {
				transition: all 0.3s ease;
				font-size: 1.125rem;
				background: linear-gradient(145deg, #7c3aed 0%, #8b5cf6 100%);
				box-shadow: 0 4px 6px rgba(124, 58, 237, 0.2);
			}
			.bubble-btn:hover {
				transform: translateY(-2px);
				box-shadow: 0 6px 12px rgba(124, 58, 237, 0.3);
			}
			.bubble-btn-accent {
				background: linear-gradient(145deg, #06b6d4 0%, #22d3ee 100%);
			}
			.bubble-btn-accent:hover {
				box-shadow: 0 6px 12px rgba(34, 211, 238, 0.3);
			}
			.bubble-btn-gray {
				background: linear-gradient(145deg, #e5e7eb 0%, #d1d5db 100%);
			}
			.bubble-btn-gray:hover {
				box-shadow: 0 6px 12px rgba(209, 213, 219, 0.3);
			}

            .emotion-joy {
                background: linear-gradient(145deg, #FFD700 0%, #FFC107 100%);
            }

            .emotion-surprise {
                background: linear-gradient(145deg, #FF4500 0%, #FF6347 100%);
            }

            .emotion-calm {
                background: linear-gradient(145deg, #00CED1 0%, #20B2AA 100%);
            }

			input[type="range"] {
				-webkit-appearance: none;
				height: 8px;
				background: linear-gradient(90deg, #e5e7eb 0%, #d1d5db 100%);
				border-radius: 8px;
				outline: none;
			}
			input[type="range"]::-webkit-slider-thumb {
				-webkit-appearance: none;
				width: 22px;
				height: 22px;
				border-radius: 50%;
				background: linear-gradient(145deg, #7c3aed 0%, #8b5cf6 100%);
				cursor: pointer;
				border: 3px solid white;
				box-shadow: 0 2px 8px rgba(124, 58, 237, 0.4);
			}
			.dark input[type="range"] {
				background: linear-gradient(90deg, #4b5563 0%, #374151 100%);
			}
			.dark input[type="range"]::-webkit-slider-thumb {
				background: linear-gradient(145deg, #8b5cf6 0%, #7c3aed 100%);
				border-color: #1f2937;
			}

			#score-progress {
				transition: stroke-dasharray 0.6s ease-in-out, stroke 0.3s ease;
				transform: rotate(-90deg);
				transform-origin: 50% 50%;
			}

			.dark #score-progress {
				stroke-opacity: 0.9;
			}
            
            /* New styles for the intro panel */
            .intro-panel {
                background: rgba(255,255,255,0.7);
                backdrop-filter: blur(8px);
                border-radius: 12px;
                border: 1px solid rgba(255,255,255,0.5);
                box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            }
            
            .dark .intro-panel {
                background: rgba(30,41,59,0.7);
                border: 1px solid rgba(55,65,81,0.5);
            }
            
            /* Animation enhancements */
            @keyframes float {
                0% { transform: translateY(0px); }
                50% { transform: translateY(-10px); }
                100% { transform: translateY(0px); }
            }
            
            .emoji-float {
                animation: float 3s ease-in-out infinite;
            }
            
            .emoji-float:nth-child(2) {
                animation-delay: 0.3s;
            }
            
            .emoji-float:nth-child(3) {
                animation-delay: 0.6s;
            }
            
            /* Tool tip styles */
            .tooltip {
                position: relative;
            }
            
            .tooltip .tooltip-text {
                visibility: hidden;
                width: 200px;
                background-color: rgba(17, 24, 39, 0.9);
                color: #fff;
                text-align: center;
                border-radius: 6px;
                padding: 8px;
                position: absolute;
                z-index: 1;
                bottom: 125%;
                left: 50%;
                margin-left: -100px;
                opacity: 0;
                transition: opacity 0.3s;
            }
            
            .tooltip:hover .tooltip-text {
                visibility: visible;
                opacity: 1;
            }
            
            .dark .tooltip .tooltip-text {
                background-color: rgba(255, 255, 255, 0.9);
                color: #111827;
            }
            
            /* Animation stats panel */
            .stats-panel {
                background: rgba(255,255,255,0.2);
                backdrop-filter: blur(4px);
                border-radius: 8px;
                border: 1px solid rgba(255,255,255,0.1);
            }
            
            .dark .stats-panel {
                background: rgba(30,41,59,0.2);
                border: 1px solid rgba(55,65,81,0.1);
            }
            
            /* Custom select styling */
            .emotion-select {
                background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%238B5CF6'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
                background-repeat: no-repeat;
                background-position: right 1rem center;
                background-size: 1.5em 1.5em;
                padding-right: 2.5rem;
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
            }
            
            /* Animation for reaction elements */
            @keyframes pulse {
                0% { transform: scale(1); opacity: 0.7; }
                50% { transform: scale(1.1); opacity: 1; }
                100% { transform: scale(1); opacity: 0.7; }
            }
            
            .pulse {
                animation: pulse 2s infinite ease-in-out;
            }
		</style>
	</head>
	<body class="min-h-screen flex items-center justify-center p-4 md:p-8 dark:text-gray-100">
		<div class="container mx-auto max-w-6xl bg-gradient-to-br from-white to-gray-50 rounded-2xl shadow-xl overflow-hidden animation-container dark:from-gray-800 dark:to-gray-900">
			<!-- Header -->
			<header class="bg-gradient-to-r from-emotion-primary to-emotion-secondary p-6 md:p-8 text-white">
				<div class="flex flex-col md:flex-row justify-between items-center">
					<h1 class="text-3xl md:text-4xl font-bold font-heading tracking-tight mb-4 md:mb-0">
						<i class="fas fa-palette mr-3"></i> Emotion Canvas
					</h1>
                    <div class="flex items-center space-x-4">
                        <button id="help-button" class="bubble-btn p-3 rounded-full hover:bg-white/30">
                            <i class="fas fa-question-circle text-white"></i>
                        </button>
                        <button id="theme-toggle" class="bubble-btn p-3 rounded-full hover:bg-white/30">
                            <i class="fas fa-moon text-white"></i>
                        </button>
                    </div>
				</div>
			</header>

            <!-- Welcome Panel (initially visible) -->
            <div id="welcome-panel" class="intro-panel p-6 m-6 flex flex-col md:flex-row items-center">
                <div class="flex-1">
                    <h2 class="text-2xl font-bold mb-3 text-emotion-primary">Welcome to Emotion Canvas!</h2>
                    <p class="mb-4 text-gray-800 dark:text-gray-200">Design beautiful, animated social media reactions with our easy-to-use tool. Perfect for creating engaging, emotion-driven animations for your website or app.</p>
                    <ul class="mb-4 space-y-2">
                        <li class="flex items-center">
                            <i class="fas fa-check-circle text-emotion-primary mr-2"></i>
                            <span class="text-gray-800 dark:text-gray-200">Choose emotions with customized emojis</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check-circle text-emotion-primary mr-2"></i>
                            <span class="text-gray-800 dark:text-gray-200">Adjust size, speed and spread of reactions</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-check-circle text-emotion-primary mr-2"></i>
                            <span class="text-gray-800 dark:text-gray-200">Preview and export your animations</span>
                        </li>
                    </ul>
                    <button id="get-started" class="bubble-btn text-white py-3 px-6 rounded-lg">
                        <i class="fas fa-rocket mr-2"></i> Get Started
                    </button>
                </div>
                <div class="flex-1 flex justify-center mt-6 md:mt-0">
                    <div class="relative h-32 w-32">
                        <span class="absolute text-5xl emoji-float" style="left: 10%; top: 20%;">😊</span>
                        <span class="absolute text-5xl emoji-float" style="left: 50%; top: 0%;">✨</span>
                        <span class="absolute text-5xl emoji-float" style="left: 80%; top: 30%;">🌟</span>
                    </div>
                </div>
            </div>

			<!-- Main Content -->
			<main class="grid md:grid-cols-3 gap-6 p-6 md:gap-10 md:p-8">
				<!-- Controls -->
				<section class="space-y-6 md:col-span-1">
					<div class="mb-6">
						<label class="block text-lg font-semibold text-gray-800 dark:text-gray-200 mb-3">Emotion</label>
						<select id="emotion" class="emotion-select w-full p-4 rounded-lg border border-gray-200 focus:ring-2 focus:ring-emotion-accent text-lg bg-white dark:bg-gray-700 dark:border-gray-600 dark:text-white">
							<option value="joy">Joy 😊</option>
							<option value="surprise">Surprise 😲</option>
							<option value="calm">Calm 😌</option>
						</select>
					</div>

					<!-- Collapsible Controls Section -->
                    <div class="p-4 border border-gray-200 rounded-lg dark:border-gray-700">
                        <button class="flex justify-between items-center w-full mb-2 text-lg font-semibold text-gray-800 dark:text-gray-200" id="toggle-controls">
                            <span>Animation Settings</span>
                            <i class="fas fa-chevron-down transition-transform duration-300"></i>
                        </button>
                        
                        <div id="controls-content" class="space-y-6">
                            <!-- Sliders with improved styling -->
                            <div>
                                <label class="flex justify-between text-base mb-2 text-gray-800 dark:text-gray-200">
                                    <span>Size</span>
                                    <div class="tooltip">
                                        <span id="size-value" class="text-emotion-primary font-bold">20</span>
                                        <span class="tooltip-text">Controls the size of emoji reactions</span>
                                    </div>
                                </label>
                                <input id="size" type="range" min="10" max="50" value="20" class="w-full" />
                            </div>
                            
                            <div>
                                <label class="flex justify-between text-base mb-2 text-gray-800 dark:text-gray-200">
                                    <span>Speed</span>
                                    <div class="tooltip">
                                        <span id="speed-value" class="text-emotion-primary font-bold">5</span>
                                        <span class="tooltip-text">Controls how fast the reactions animate</span>
                                    </div>
                                </label>
                                <input id="speed" type="range" min="1" max="10" value="5" class="w-full" />
                            </div>
                            
                            <div>
                                <label class="flex justify-between text-base mb-2 text-gray-800 dark:text-gray-200">
                                    <span>Spread</span>
                                    <div class="tooltip">
                                        <span id="spread-value" class="text-emotion-primary font-bold">100</span>
                                        <span class="tooltip-text">Controls how far reactions spread from the center</span>
                                    </div>
                                </label>
                                <input id="spread" type="range" min="50" max="200" value="100" class="w-full" />
                            </div>
                            
                            <div class="flex items-center space-x-4 mt-6 text-gray-800 dark:text-gray-200">
                                <label class="flex items-center text-base tooltip">
                                    <input id="loop" type="checkbox" class="mr-2 rounded border-gray-300 dark:bg-gray-700" />
                                    <span>Loop Preview</span>
                                    <span class="tooltip-text">Continuously run the animation</span>
                                </label>
                                <label class="flex items-center text-base tooltip">
                                    <input id="react-mode" type="checkbox" class="mr-2 rounded border-gray-300 dark:bg-gray-700" />
                                    <span>React Mode</span>
                                    <span class="tooltip-text">Simulate reactions on social media posts</span>
                                </label>
                            </div>
                        </div>
                    </div>

					<!-- Action Buttons -->
					<div class="grid grid-cols-2 gap-4">
						<button id="preview" class="bubble-btn text-white py-3 rounded-lg hover:scale-105 transition-transform">
							<i class="fas fa-play mr-2"></i> Preview
						</button>
						<button id="export" class="bubble-btn-accent bubble-btn text-white py-3 rounded-lg hover:scale-105 transition-transform">
							<i class="fas fa-download mr-2"></i> Export
						</button>
						<button id="save" class="bubble-btn-gray text-gray-800 py-3 rounded-lg col-span-2 dark:text-gray-800 hover:scale-105 transition-transform">
							<i class="fas fa-save mr-2"></i> Save Design
						</button>
					</div>

					<!-- Reset Button -->
					<button id="reset" class="bubble-btn bg-gradient-to-r from-red-500 to-pink-600 text-white py-3 rounded-lg w-full text-lg shadow-red-200 hover:shadow-lg hover:scale-105 transition-transform">
						<i class="fas fa-undo mr-2"></i> Reset
					</button>
				</section>

				<!-- Animation Canvas and Stats - Larger space -->
				<section class="md:col-span-2 space-y-4">
                    <!-- Animation Canvas -->
					<div id="plotly-canvas" class="w-full h-64 md:h-96 bg-gradient-to-br from-gray-100 to-gray-50 rounded-lg shadow-inner dark:from-gray-700 dark:to-gray-800"></div>
					
                    <!-- Stats Row -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <!-- Expressiveness Score -->
                        <div class="stats-panel p-3 flex flex-col items-center">
                            <div class="relative w-16 h-16">
                                <!-- Background circle -->
                                <svg class="w-full h-full" viewBox="0 0 36 36">
                                    <path
                                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                        fill="none"
                                        stroke="#d4d6d9"
                                        stroke-width="3"
                                        stroke-dasharray="100, 100" />
                                    <path
                                        id="score-progress"
                                        d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                                        fill="none"
                                        stroke="#8B5CF6"
                                        stroke-width="3"
                                        stroke-dasharray="0, 100"
                                        class="transition-all duration-500 ease-out" />
                                </svg>
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <span id="score-value" class="text-xl font-bold text-emotion-primary">0</span>
                                </div>
                            </div>
                            <div class="text-sm font-medium text-gray-800 dark:text-gray-200">
                                Expressiveness
                            </div>
                        </div>
                        
                        <!-- Particles Count -->
                        <div class="stats-panel p-3 flex flex-col items-center justify-center">
                            <span id="particles-count" class="text-xl font-bold text-emotion-primary">20</span>
                            <div class="text-sm font-medium text-gray-800 dark:text-gray-200">
                                Particles
                            </div>
                        </div>
                        
                        <!-- Animation FPS -->
                        <div class="stats-panel p-3 flex flex-col items-center justify-center">
                            <span id="animation-fps" class="text-xl font-bold text-emotion-primary">0</span>
                            <div class="text-sm font-medium text-gray-800 dark:text-gray-200">
                                FPS
                            </div>
                        </div>
                        
                        <!-- Current Theme -->
                        <div class="stats-panel p-3 flex flex-col items-center justify-center">
                            <span id="current-theme" class="text-xl font-bold text-emotion-primary">Joy</span>
                            <div class="text-sm font-medium text-gray-800 dark:text-gray-200">
                                Theme
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mock Social Media Post with better styling -->
                    <div id="social-post" class="hidden p-4 bg-white dark:bg-gray-700 rounded-lg shadow-md text-gray-800 dark:text-gray-200">
                        <div class="flex items-center mb-3">
                            <div class="w-10 h-10 rounded-full bg-emotion-primary flex items-center justify-center text-white">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="ml-3">
                                <p class="font-semibold">User123</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">Just now</p>
                            </div>
                        </div>
                        <p class="mb-3">Check out this awesome moment! 🎉</p>
                        <div class="bg-gray-100 dark:bg-gray-600 p-3 rounded-lg text-center">
                            <p class="text-sm text-gray-600 dark:text-gray-300">Click here to see reactions!</p>
                            <div class="flex justify-center space-x-2 mt-2">
                                <span class="text-2xl pulse">👆</span>
                            </div>
                        </div>
                    </div>
				</section>
			</main>
		</div>

		<script>
			// Reaction Elements
			const reactions = [
				{
					emotion: "joy",
					elements: ["😊", "✨", "🌟", "🎉", "😄"],
					colors: ["#FFD700", "#FF69B4", "#FFA500"],
					burst: true,
				},
				{
					emotion: "surprise",
					elements: ["😲", "❗", "💥", "🤯", "😮"],
					colors: ["#FF4500", "#FFA500", "#FF6347"],
					burst: true,
				},
				{
					emotion: "calm",
					elements: ["😌", "💧", "🌊", "🧘", "✨"],
					colors: ["#00CED1", "#4682B4", "#87CEEB"],
					burst: false,
				},
			];

			// Default Animation Config
			const defaultConfig = {
				emotion: "joy",
				size: 20,
				speed: 5,
				spread: 100,
				loop: false,
				reactMode: false,
			};

			let animationConfig = { ...defaultConfig };
			let animationFrame = null;
            let lastFrameTime = 0;
            let frameCount = 0;
            let fps = 0;
            let fpsUpdateInterval;

			// DOM Elements
			const emotionSelect = document.getElementById("emotion");
			const sizeInput = document.getElementById("size");
			const speedInput = document.getElementById("speed");
			const spreadInput = document.getElementById("spread");
			const loopCheckbox = document.getElementById("loop");
			const reactModeCheckbox = document.getElementById("react-mode");
			const previewButton = document.getElementById("preview");
			const saveButton = document.getElementById("save");
			const exportButton = document.getElementById("export");
			const resetButton = document.getElementById("reset");
			const themeToggle = document.getElementById("theme-toggle");
			const scoreValue = document.getElementById("score-value");
			const plotlyCanvas = document.getElementById("plotly-canvas");
			const socialPost = document.getElementById("social-post");
            const welcomePanel = document.getElementById("welcome-panel");
            const getStartedBtn = document.getElementById("get-started");
            const helpButton = document.getElementById("help-button");
            const toggleControlsBtn = document.getElementById("toggle-controls");
            const controlsContent = document.getElementById("controls-content");
            const particlesCount = document.getElementById("particles-count");
            const animationFps = document.getElementById("animation-fps");
            const currentTheme = document.getElementById("current-theme");

			// Initialize Plotly Canvas with improved styling
			const layout = {
				showlegend: false,
				xaxis: {
					range: [0, 400],
					showgrid: false,
					zeroline: false,
					visible: false,
				},
				yaxis: {
					range: [0, 400],
					showgrid: false,
					zeroline: false,
					visible: false,
				},
				margin: { t: 0, b: 0, l: 0, r: 0 },
				paper_bgcolor: "#dfe1e6",
				plot_bgcolor: "rgba(0,0,0,0)",
                hovermode: false,
			};
			Plotly.newPlot(plotlyCanvas, [], layout);

			// Update slider value displays
			function updateSliderValues() {
				document.getElementById("size-value").textContent = sizeInput.value;
				document.getElementById("speed-value").textContent = speedInput.value;
				document.getElementById("spread-value").textContent = spreadInput.value;
			}

			sizeInput.addEventListener("input", () => {
				document.getElementById("size-value").textContent = sizeInput.value;
				updateConfig();
			});

			speedInput.addEventListener("input", () => {
				document.getElementById("speed-value").textContent = speedInput.value;
				updateConfig();
			});

			spreadInput.addEventListener("input", () => {
				document.getElementById("spread-value").textContent = spreadInput.value;
				updateConfig();
			});

			// Update Animation Config
			function updateConfig() {
				animationConfig.emotion = emotionSelect.value;
				animationConfig.size = parseInt(sizeInput.value);
				animationConfig.speed = parseInt(speedInput.value);
				animationConfig.spread = parseInt(spreadInput.value);
				animationConfig.loop = loopCheckbox.checked;
				animationConfig.reactMode = reactModeCheckbox.checked;
				socialPost.classList.toggle("hidden", !animationConfig.reactMode);
				updateSliderValues();
				updateExpressivenessScore();
                updateStatsDisplay();
			}
            
            // Update stats display
            function updateStatsDisplay() {
                currentTheme.textContent = animationConfig.emotion.charAt(0).toUpperCase() + animationConfig.emotion.slice(1);
                currentTheme.style.color = document.body.classList.contains('dark') ? 
                    `var(--tw-color-${animationConfig.emotion})` : 
                    `var(--tw-color-${animationConfig.emotion})`;
                
                const count = animationConfig.reactMode ? 15 : 25;
                particlesCount.textContent = count;
                
                // Update FPS counter (will be set during animation)
                if (!fpsUpdateInterval) {
                    fpsUpdateInterval = setInterval(() => {
                        animationFps.textContent = fps;
                        fps = 0;
                    }, 1000);
                }
            }

			// Calculate Expressiveness Score
			function updateExpressivenessScore() {
				const intensity =
					(animationConfig.size / 50) * 0.4 +
					(animationConfig.speed / 10) * 0.3 +
					(animationConfig.spread / 200) * 0.3;
				const score = Math.round(intensity * 100);
				scoreValue.textContent = score;

				// Update the circular progress bar
				const progressCircle = document.getElementById("score-progress");
				const dashArrayValue = `${score}, 100`;
				progressCircle.style.strokeDasharray = dashArrayValue;

				// Change color based on score
				if (score > 75) {
					progressCircle.style.stroke = "#10B981";
				} else if (score > 50) {
					progressCircle.style.stroke = "#3B82F6";
				} else if (score > 25) {
					progressCircle.style.stroke = "#F59E0B";
				} else {
					progressCircle.style.stroke = "#EF4444";
				}
			}

			// Generate Animation Data with improved distribution and variety
			function generateAnimationData() {
				const reaction = reactions.find(
					(r) => r.emotion === animationConfig.emotion
				);
				const particles = [];
				const count = animationConfig.reactMode ? 15 : 25; // Increased particle count
                
                const centerX = 200;
                const centerY = 200;
                
				for (let i = 0; i < count; i++) {
                    // Create staggered starting points for more natural looking bursts
                    const startOffset = reaction.burst ? Math.random() * 20 : 0;
                    const startX = centerX + (Math.random() - 0.5) * startOffset;
                    const startY = centerY + (Math.random() - 0.5) * startOffset;
                    
                    // Create more varied end positions
					const angle = Math.random() * 2 * Math.PI;
					const distance = Math.random() * animationConfig.spread * (0.8 + Math.random() * 0.4); // Add variance
					const endX = centerX + Math.cos(angle) * distance;
					const endY = centerY + Math.sin(angle) * distance;
                    
                    // Add size variation
                    const sizeVariation = 0.8 + Math.random() * 0.4; // 80-120% of base size
                    const particleSize = animationConfig.size * sizeVariation;
                    
					const element = reaction.elements[Math.floor(Math.random() * reaction.elements.length)];
                    
                    // Add rotation for some elements
                    const rotate = Math.random() > 0.5 ? `rotate(${Math.floor(Math.random() * 90 - 45)}deg)` : '';
                    
					particles.push({
						x: [startX, endX],
						y: [startY, endY],
						text: element,
						mode: "text",
						textfont: {
							size: particleSize,
							color: reaction.colors[Math.floor(Math.random() * reaction.colors.length)],
                            family: "sans-serif"
						},
                        textposition: "middle center",
                        hoverinfo: "none"
					});
				}
				return particles;